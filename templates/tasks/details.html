{% extends "layout.html" %}
{% load i18n render_status %}
{% block pagetitle %}{% trans "Task Details" %}{% endblock %}
{% block info_block %}
<section class="info">
    <h2><i class="fa fa-list-alt irm"></i> {% trans "Task Details" %}
    {% if perm.can_edit %} <a href="{% url "task_edit" object.id %}" title="{% trans "Edit task" %}"><i class="fa fa-pencil-square-o" style="margin-left:.5em"></i></a></h2>
    {% endif  %}
</section>
{% endblock %}
{% block content %}
<section class="container-fluid task-details" style="margin: 0 auto">
    {% if messages %}
    <ul class="messages">
        {% for message in messages %}
        <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>
            {{ message }}</li>
            {% endfor %}
    </ul>
    {% endif %}
    <div class="row">
        <div class="col-md-3">
            <div class="panel panel-default">
                <div class="panel-heading">
                    Attributes
                </div>
                <div class="panel-body" style="line-height: 160%">
                    <i class="fa fa-info-circle fa-fw irm"></i><strong>{% trans "ID" %}</strong>: <em>{{object.id}}</em>
                    <br>
                    {% if site == 'admin' %}
                    <i class="fa fa-globe fa-fw irm"></i><strong>{% trans "Site" %}</strong>: <em>{{object.site}}</em>
                    <br>
                    <i class="fa fa-user fa-fw irm"></i><strong>{% trans "Owner" %}</strong>: <em><a href="{% url 'user_edit' object.owner.id %}">{{object.owner}}</a></em>
                    <br>
                    <i class="fa fa-user fa-fw irm"></i><strong>{% trans "Manager" %}</strong>: <em> {% if object.manager %} <a href="{% url 'user_edit' object.manager.id %}">{{object.manager}}</a> {% endif %} </em>
                    <br>
                    <i class="fa fa-user fa-fw irm"></i><strong>{% trans "Writer" %}</strong>: <em> {% if object.assignee %} <a href="{% url 'user_edit' object.assignee.id %}">{{object.assignee}}</a> {% endif %} </em>
                    <br>
                    <i class="fa fa-user fa-fw irm"></i><strong>{% trans "Editor" %}</strong>: <em>{{object.writer}}</em>
                    <br>
                    <i class="fa fa-clock-o fa-fw irm"></i><strong>{% trans "Local time" %}</strong>: <em>{{object.local_time}}</em>
                    <br>
                    <i class="fa fa-star-half-o fa-fw irm"></i><strong>{% trans "Mark" %}</strong>: <em>{{object.mark}}</em>
                    <br>
                    <i class="fa fa-eye fa-fw irm"></i><strong>{% trans "Access" %}</strong>: <em>{{object.get_access_level}}</em>
                    <br>
                    <i class="fa fa-lock fa-fw irm"></i><strong>{% trans "Revision" %}</strong>: <em>{{object.revision}}</em>
                    <br>
                    <i class="fa fa-barcode fa-fw irm"></i><strong>{% trans "Discount" %}</strong>: <em>{{object.discount}}</em>
                    <br>
                    <i class="fa fa-credit-card fa-fw irm"></i><strong>{% trans "Payment" %}</strong>: <em>{{object.get_payment_status}}</em>
                    <br>
                    <i class="fa fa-money fa-fw irm"></i><strong>{% trans "Price" %}</strong>: <em>{{object.price}}</em>
                    <br>
                    <i class="fa fa-exclamation-circle fa-fw irm"></i><strong>{% trans "Priority" %}</strong>: <em>{{object.priority}}</em>
                    <hr>
                    <form action="{% url 'task_force_status' object.pk %}" method="post" id="admin_actions">
                        {% csrf_token %}
                        <div class="btn-group">
                            <button id="admin_actions_button" type="button" style="min-width:190px" class="btn btn-default btn-lg" data-status="">
                                Select status
                            </button>
                            <button type="button" class="btn btn-info btn-lg dropdown-toggle" data-toggle="dropdown">
                                <span class="caret"></span>
                                <span class="sr-only">Toggle Dropdown</span>
                            </button>
                            <ul class="dropdown-menu" role="menu" id="admin_actions_list" style="min-width:190px">
                                <!-- style="min-width:245px" -->
                                <li>
                                    <a href="#" data-status="{{co.UNPROCESSED}}">{{co.UNPROCESSED|render_status}}<span class="ilm">{% trans "Unprocessed" %}</span></a>
                                </li>
                                <li>
                                    <a href="#" data-status="{{co.PROCESSING}}">{{co.PROCESSING|render_status}}<span class="ilm">{% trans "Processing" %}</span></a>
                                </li>
                                <li>
                                    <a href="#" data-status="{{co.COMPLETED}}">{{co.COMPLETED|render_status}}<span class="ilm">{% trans "Completed" %}</span></a>
                                </li>
                                <li>
                                    <a href="#" data-status="{{co.REJECTED}}">{{co.REJECTED|render_status}}<span class="ilm">{% trans "Rejected" %}</span></a>
                                </li>
                                <li>
                                    <a href="#" data-status="{{co.SUSPICIOUS}}">{{co.SUSPICIOUS|render_status}}<span class="ilm">{% trans "Suspicious" %}</span></a>
                                </li>
                                <li>
                                    <a href="#" data-status="{{co.SENT}}">{{co.SENT|render_status}}<span class="ilm">{% trans "Sent" %}</span></a>
                                </li>
                            </ul>
                        </div>
                    </form>
                    {% elif site == 'customer' %}
                    <i class="fa fa-user fa-fw irm"></i><strong>{% trans "Writer" %}</strong>: <em>{{object.assignee}}</em>
                    <br>
                    <i class="fa fa-lock fa-fw irm"></i><strong>{% trans "Revision" %}</strong>: <em>{{object.revision}}</em>
                    <br>
                    <i class="fa fa-credit-card fa-fw irm"></i><strong>{% trans "Payment" %}</strong>: <em>{{object.get_payment_status}}</em>
                    <br>
                    <i class="fa fa-money fa-fw irm"></i><strong>{% trans "Price" %}</strong>: <em>{{object.price}}</em>
                    <br>
                    {% elif site == 'writer' %}
                    <i class="fa fa-star-half-o fa-fw irm"></i><strong>{% trans "Mark" %}</strong>: <em>{{object.mark}}</em>
                    <br>
                    <i class="fa fa-lock fa-fw irm"></i><strong>{% trans "Revision" %}</strong>: <em>{{object.revision}}</em>
                    <br>
                    <i class="fa fa-exclamation-circle fa-fw irm"></i><strong>{% trans "Priority" %}</strong>: <em>{{object.priority}}</em>
                    <br>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-md-{% if perm.can_approve or perm.can_reject or perm.can_suspect %}6{% else %}9{% endif %}">
            <!-- <div class="task-details-inner"> -->
            <div class="row">
                <div class="col-md-12">
                    <div class="row small highlight">
                        <div class="col-md-3">
                            <span style="font-size:1.6em">{{object.status|render_status}}</span><strong class="ilm">{% trans "Status" %}</strong>
                            <div style="margin-left:2.5em">
                                {{object.get_status}}
                            </div>
                        </div>
                        <div class="col-md-3">
                            <i class="fa fa-calendar irm" style="font-size:1.5em;"></i><strong>{% trans "Created" %}</strong>
                            <div style="margin-left:2.5em">
                                {{object.created}}
                            </div>
                        </div>
                        <div class="col-md-3">
                            <i class="fa fa-clock-o irm" style="font-size:1.6em;"></i><strong>{% trans "Updated" %}</strong>
                            <div style="margin-left:2.5em">
                                {{object.updated}}
                            </div>
                        </div>
                        <div class="col-md-3">
                            <i class="fa fa-clock-o irm" style="font-size:1.6em;color:#800"></i><strong>{% trans "Full Deadline" %}</strong>
                            <div style="margin-left:2.5em" class="momdl">
                                {{object.admin_deadline}}
                            </div>
                        </div>
                    </div>
                    <i class="fa fa-tag fa-fw irm"></i><strong>{% trans "Paper Title" %}</strong>
                    <h2 style="padding-left:1em;font-family: Georgia, 'Times New Roman', serif;text-align:justify">{{object.paper_title}}</h2>
                    <hr>
                    <i class="fa fa-file-text fa-fw irm"></i><strong>{% trans "Instructions" %}</strong>
                    <br>
                    <p style="white-space:pre-line;color:#555;padding-left:2em;padding-top:1em;text-align:justify;font-style:italic;line-height: 160%">
                        {{object.instructions}}
                    </p>
                </div>
            </div>
            <hr>
            <div class="row" style="line-height: 160%">
                <div class="col-md-4">
                    <i class="fa fa-list-alt fa-fw irm"></i><strong>{% trans "Assigment" %}</strong>: <em>{{object.get_assigment}}</em>
                    <br>
                    <i class="fa fa-clock-o fa-fw irm"></i><strong>{% trans "Urgency" %}</strong>: <em>{{object.get_urgency}}</em>
                    <br>
                    <i class="fa fa-files-o fa-fw irm"></i><strong>{% trans "Page Number" %}</strong>: <em>{{object.page_number}}</em>
                    <br>
                </div>
                <div class="col-md-4">
                    <i class="fa fa-arrows-v fa-fw irm"></i><strong>{% trans "Spacing" %}</strong>: <em>{{object.get_spacing}}</em>
                    <br>
                    <i class="fa fa-book fa-fw irm"></i><strong>{% trans "Discipline" %}</strong>: <em>{{object.get_discipline}}</em>
                    <br>
                    <i class="fa fa-certificate fa-fw irm"></i><strong>{% trans "Level" %}</strong>: <em>{{object.get_level}}</em>
                    <br>
                </div>
                <div class="col-md-4">
                    <i class="fa fa-building-o fa-fw irm"></i><strong>{% trans "Style" %}</strong>: <em>{{object.get_style}}</em>
                    <br>
                    <i class="fa fa-bars fa-fw irm"></i><strong>{% trans "Sources Number" %}</strong>: <em>{{object.source_number}}</em>
                    <br>
                    <i class="fa fa-paperclip fa-fw irm"></i><strong>{% trans "Attach" %}</strong>: <em>{{object.attach}}</em>
                    <br>
                </div>
            </div>
            <hr>
            <!-- buttons -->
            <form action="#" method="post"  id="admin_flat_form">
                {% csrf_token %}
                <div class="btn-group" id="admin_flat_buttons">
                    {% if perm.can_delete %}
                    <button type="submit" data-status="1000" data-url="{% url 'task_remove'  object.pk %}" class="btn btn-primary btn-lg" role="button">
                        {% trans "Delete" %}<i class='fa fa-check-circle' style="margin-left:.5em"></i>
                    </button>
                    {% endif %}
                    {% if perm.can_submit %}
                    <button type="submit" data-status="{{co.UNPROCESSED}}" data-url="{% url 'task_status' object.pk %}" class="btn btn-primary btn-lg" role="button">
                        {% trans "Submit" %}<i class='fa fa-check-circle' style="margin-left:.5em"></i>
                    </button>
                    {% endif %}
                    {% if perm.can_finish %}
                    <button type="button" data-status="{{co.COMPLETED}}" data-url="{% url 'task_status' object.pk %}" class="btn btn-primary btn-lg" role="button">
                        {% trans "Complete Task" %}<i class='fa fa-check-circle' style="margin-left:.5em"></i>
                    </button>
                    {% endif %}
                    {% if perm.can_send %}
                    <a data-status="{{co.SENT}}" data-url="{% url 'task_status' object.pk %}" class="btn btn-primary btn-lg send" role="button"> {% trans "Send" %}<i class='fa fa-upload' style="margin-left:.5em"></i> </a>
                    {% endif %}
                    {% if perm.can_lock %}
                    <button type="button" data-status="1000" data-url="{% url 'task_lock' object.pk %}" class="btn btn-primary btn-lg" role="button">
                        {% trans "Lock" %}<i class='fa fa-lock' style="margin-left:.5em"></i>
                    </button>
                    {% endif %}
                    {% if perm.can_unlock %}
                    <button type="button" data-status="1000"  data-url="{% url 'task_unlock' object.pk %}" class="btn btn-primary btn-lg" role="button">
                        {% trans "Unlock" %}<i class='fa fa-check-circle' style="margin-left:.5em"></i>
                    </button>
                    {% endif %}
                    {% if perm.can_reject %}
                    <button type="button" data-status="{{co.REJECTED}}" data-url="{% url 'task_status' object.pk %}" class="btn btn-danger btn-lg" role="button">
                        {% trans "Reject" %} <i class="fa fa-thumbs-o-down" style="margin-left:.5em"></i>
                    </button>
                    {% endif %}
                    {% if perm.can_suspect %}
                    <button type="button" data-status="{{co.SUSPICIOUS}}" data-url="{% url 'task_status' object.pk %}" class="btn btn-default btn-lg" role="button">
                        {% trans "Suspect" %} <i class="fa fa-warning" style="margin-left:.5em"></i>
                    </button>
                    {% endif %}
                    {% if perm.can_approve %}
                    <button type="button" data-status="{{co.PROCESSING}}"  data-url="{% url 'task_status' object.pk %}" class="btn btn-primary btn-lg">
                        {% trans "Approve" %} <i class="fa fa-thumbs-o-up" style="margin-left:.5em"></i>
                    </button>
                    {% endif %}
                </div>
            </form>
            <!-- .buttons -->
        </div>
        {% if perm.can_report %}
        <div class="col-md-3 admin-reports">
            <div class="well well-sm">
                <a class="pull-right adm-report-add" href="#"><i class="fa fa-plus-circle"></i></a>
                <strong>{% trans "Admin reports"%}</strong><span class="ilm badge">{{stats.adm_reports}}</span>
                <div id="report-form" style="display:none">
                    <form action="{% url "report_new" object.pk %}" method="post">
                        {% csrf_token %}
                        <input type="text" name="title" class="form-control" required placeholder="Report title">
                        <textarea row="4" name="body" class="form-control" required placeholder="Report text"></textarea>
                        <div style="text-align:right">
                            <button type="submit" class="btn btn-primary">
                                Post<i class="fa fa-check-square-o ilm"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            <div id="adm-report-holder">
                {% for report in reports %}
                <div class="panel panel-warning">
                    <form id="report_remove" action="{% url "report_remove" report.pk %}" method="post">
                        {% csrf_token %}
                    </form>
                    <div class="panel-heading">
                        <h3 class="panel-title"><a class="pull-right adm-report-ctrl" data-body-id="{{report.pk}}" href="#"><i class="fa fa-caret-square-o-down"></i></a><a class="pull-right adm-report-del" id="rep-del-{{report.pk}}" onclick="$('#report_remove').submit();" href="#" style="display:none"> <i class="fa fa-times-circle"></i> </a> {{report.title}}</h3>
                    </div>
                    <div id="body-id-{{report.pk}}" class="panel-body small" style="display:none">
                        {{report.body}}
                    </div>
                    <div class="panel-footer small">
                        by <a href="{% url "user_details" report.rowner.pk %}">{{report.rowner}}</a><span class="pull-right"><i class="fa fa-1 fa-calendar irm"></i>{{report.created}}</span>
                    </div>
                </div>
                {% endfor  %}
            </div>
        </div>
        {% endif %}
    </div>
    {% if site == "writer" %}
    <!-- Writer send file modal popup-->
    <div class="modal fade" id="writer-send" tabindex="-1" role="dialog" aria-labelledby="writer-send-label" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        <i class="fa fa-times-circle"></i>
                    </button>
                    <h4 class="modal-title" id="writer-send-label">{% trans "Send a file" %}</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group{% if form.attach.errors %} has-error{% endif %}">
                        <div class="file-input form-control">
                            <div class="input-group margin-bottom-sm">
                                <span class="input-group-addon"><i class="fa fa-paperclip fa-fw"></i></span>
                                <input id="writer-attach" class="upload-file" type="file" title="Browse" name="attach">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">
                        {% trans "Close" %}<i class="fa fa-times-circle ilm"></i>
                    </button>
                    <button type="button" class="btn btn-primary">
                        {% trans "Send" %}<i class="fa fa-upload ilm"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</section>
{% endblock %}
